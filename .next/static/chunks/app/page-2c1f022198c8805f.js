(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{6094:(e,s,t)=>{Promise.resolve().then(t.bind(t,9887))},9887:(e,s,t)=>{"use strict";t.d(s,{default:()=>F});var a=t(5155),r=t(2115),l=t(9540),n=t(6191),i=t(7586),o=t(1360);let d=e=>{let{conversations:s,currentConversationId:t,onSelectConversation:r,onNewChat:l,onDeleteConversation:d,isOpen:c,onClose:m}=e;return(0,a.jsxs)(a.Fragment,{children:[c&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 z-40 md:hidden",onClick:m}),(0,a.jsxs)("div",{className:"\n        fixed md:static inset-y-0 left-0 z-50\n        w-[260px] bg-[var(--sidebar-bg)] border-r border-[var(--border-color)]\n        transform transition-transform duration-300 ease-in-out\n        ".concat(c?"translate-x-0":"-translate-x-full md:translate-x-0","\n        flex flex-col h-full\n      "),children:[(0,a.jsx)("div",{className:"p-3 border-b border-[var(--border-color)]",children:(0,a.jsxs)("button",{onClick:()=>{l(),window.innerWidth<768&&m()},className:"w-full flex items-center gap-3 px-3 py-3 rounded-lg border border-[var(--border-color)] hover:bg-[var(--message-user)] transition-colors text-sm text-[var(--foreground)]",children:[(0,a.jsx)(n.A,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:"New chat"})]})}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto scrollbar-thin p-3 space-y-2",children:0===s.length?(0,a.jsx)("div",{className:"text-center text-gray-500 text-sm py-10",children:"No previous conversations"}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"text-xs font-semibold text-gray-500 px-3 py-2",children:"History"}),s.map(e=>(0,a.jsxs)("div",{className:"\n                    group relative flex items-center gap-3 px-3 py-3 rounded-lg cursor-pointer\n                    transition-colors text-sm overflow-hidden\n                    ".concat(t===e.id?"bg-[var(--message-user)] text-[var(--foreground)]":"text-gray-400 hover:bg-[#2a2a2a] hover:text-[var(--foreground)]","\n                  "),onClick:()=>{r(e.id),window.innerWidth<768&&m()},children:[(0,a.jsx)(i.A,{className:"w-4 h-4 flex-shrink-0"}),(0,a.jsx)("span",{className:"truncate flex-1 pr-6",children:e.title}),(0,a.jsx)("button",{onClick:s=>d(e.id,s),className:"\n                      absolute right-2 p-1 rounded hover:bg-red-500/20 hover:text-red-400\n                      transition-opacity\n                      ".concat(t===e.id?"opacity-100":"opacity-0 group-hover:opacity-100","\n                    "),"aria-label":"Delete conversation",children:(0,a.jsx)(o.A,{className:"w-4 h-4"})}),(0,a.jsx)("div",{className:"\n                    absolute right-0 top-0 bottom-0 w-8 bg-gradient-to-l\n                    ".concat(t===e.id?"from-[var(--message-user)]":"from-[var(--sidebar-bg)] group-hover:from-[#2a2a2a]","\n                    to-transparent pointer-events-none\n                  ")})]},e.id))]})}),(0,a.jsx)("div",{className:"p-3 border-t border-[var(--border-color)]",children:(0,a.jsxs)("div",{className:"flex items-center gap-3 px-3 py-3 rounded-lg hover:bg-[var(--message-user)] cursor-pointer transition-colors text-sm text-[var(--foreground)]",children:[(0,a.jsx)("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center font-bold text-xs",children:"U"}),(0,a.jsx)("div",{className:"font-medium",children:"User Account"})]})})]})]})};var c=t(9867),m=t(5880);let x=()=>(0,a.jsxs)("svg",{viewBox:"0 0 87.3 78",className:"w-5 h-5",xmlns:"http://www.w3.org/2000/svg",children:[(0,a.jsx)("path",{d:"M6.6 66.85l3.85 6.65c.8 1.4 1.95 2.5 3.3 3.3l13.75-23.8h-27.5c0 1.55.4 3.1 1.2 4.5z",fill:"#0066da"}),(0,a.jsx)("path",{d:"M43.65 25l13.75-23.8c-1.35-.8-2.9-1.2-4.5-1.2h-18.5c-1.6 0-3.15.45-4.5 1.2l-13.75 23.8z",fill:"#00ac47"}),(0,a.jsx)("path",{d:"M73.55 76.8c1.35-.8 2.5-1.9 3.3-3.3l1.6-2.75 11.1-19.25c.8-1.4 1.2-2.95 1.2-4.5h-27.502l5.852 11.5z",fill:"#ea4335"}),(0,a.jsx)("path",{d:"M43.65 25L29.9 1.2c-1.35.8-2.5 1.9-3.3 3.3l-20 34.6c-.8 1.4-1.2 2.95-1.2 4.5h27.5z",fill:"#00832d"}),(0,a.jsx)("path",{d:"M73.55 76.8L59.8 52.95L46.05 29.15 29.9 57.1l-6.95 12.05 6.2 10.75c.8 1.4 1.95 2.5 3.3 3.3z",fill:"#2684fc"}),(0,a.jsx)("path",{d:"M79.25 29.15l-13.75-23.8c-1.35-.8-2.9-1.2-4.5-1.2h-6.25l13.75 23.8z",fill:"#ffba00"})]}),u=e=>{let{data:s}=e;return(0,a.jsxs)("div",{className:"mt-4 space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between text-sm text-gray-400 mb-2",children:[(0,a.jsxs)("span",{children:["Found ",s.count," similar files"]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-xs text-gray-500",children:"Avg Similarity:"}),(0,a.jsxs)("span",{className:"bg-emerald-500/10 text-emerald-400 px-2 py-1 rounded-full text-xs font-medium",children:[(+s.avg_similarity).toFixed(0),"%"]})]})]}),(0,a.jsx)("div",{className:"grid gap-3",children:s.files.map((e,s)=>(0,a.jsxs)("div",{className:"bg-[#1e1e1e] border border-gray-700/50 rounded-xl p-4 hover:border-blue-500/30 transition-all group",children:[(0,a.jsxs)("div",{className:"flex items-start gap-4",children:[(0,a.jsx)("div",{className:"p-3 bg-white/5 rounded-xl border border-white/5",children:(0,a.jsx)(x,{})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("h4",{className:"text-sm font-semibold text-gray-200 truncate pr-2",title:e.name,children:e.name}),(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-y-1 gap-x-3 mt-2 text-xs text-gray-400",children:[e.category&&(0,a.jsxs)("span",{className:"flex items-center gap-1",children:[(0,a.jsx)("span",{className:"w-1.5 h-1.5 rounded-full bg-blue-400"}),e.category]}),e.type&&(0,a.jsx)("span",{className:"bg-gray-800 px-1.5 py-0.5 rounded text-gray-300",children:e.type})]}),e.similarity&&(0,a.jsxs)("div",{className:"mt-2 flex items-center gap-2",children:[(0,a.jsx)("div",{className:"h-1.5 flex-1 bg-gray-700/50 rounded-full overflow-hidden",children:(0,a.jsx)("div",{className:"h-full bg-gradient-to-r from-emerald-500 to-teal-400 rounded-full",style:{width:"".concat(e.similarity,"%")}})}),(0,a.jsxs)("span",{className:"text-xs font-medium text-emerald-400",children:[e.similarity,"% Match"]})]})]})]}),(0,a.jsx)("div",{className:"flex items-center gap-2 mt-4 pt-3 border-t border-gray-700/30",children:(()=>{let s=(e=>e.url||e.link||e.webViewLink||e.webContentLink||e.google_drive_web_view_link||e.google_drive_link||e.alternateLink||e.embedLink)(e);return s?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("a",{href:(e=>{if(!e)return"";try{let s=e.match(/\/d\/(.*?)\//);if(s&&s[1])return"https://drive.google.com/uc?export=download&id=".concat(s[1])}catch(e){console.error("Error parsing Drive URL",e)}return e})(s),className:"flex-1 flex items-center justify-center gap-2 text-xs font-medium bg-white/5 hover:bg-white/10 text-gray-300 py-2 rounded-lg transition-colors group/btn",children:[(0,a.jsx)(c.A,{className:"w-3.5 h-3.5 group-hover/btn:text-white"}),(0,a.jsx)("span",{children:"Download"})]}),(0,a.jsxs)("a",{href:s,target:"_blank",rel:"noopener noreferrer",className:"flex-1 flex items-center justify-center gap-2 text-xs font-medium bg-blue-500/10 hover:bg-blue-500/20 text-blue-400 py-2 rounded-lg transition-colors",children:[(0,a.jsx)(m.A,{className:"w-3.5 h-3.5"}),(0,a.jsx)("span",{children:"Open in Drive"})]})]}):(0,a.jsx)("span",{className:"text-xs text-gray-500 italic w-full text-center",children:"No link available"})})()})]},"".concat(e.id,"-").concat(s)))})]})};var h=t(9715),g=t(5917),p=t(5426);let f=e=>{let{data:s}=e,[t,l]=(0,r.useState)(!1);return(0,a.jsxs)("div",{className:"mt-4 bg-[#1e1e1e] border border-gray-700/50 rounded-xl overflow-hidden",children:[(0,a.jsxs)("div",{className:"bg-gray-800/50 px-4 py-3 border-b border-gray-700/50 flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"p-1.5 bg-purple-500/20 rounded-lg",children:(0,a.jsx)(h.A,{className:"w-4 h-4 text-purple-400"})}),(0,a.jsx)("span",{className:"text-sm font-medium text-gray-200",children:"Generated Document"})]}),(0,a.jsx)("button",{onClick:()=>{navigator.clipboard.writeText(s.document.content),l(!0),setTimeout(()=>l(!1),2e3)},className:"flex items-center gap-1.5 text-xs font-medium text-gray-400 hover:text-white transition-colors px-2 py-1 rounded bg-white/5 hover:bg-white/10",children:t?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(g.A,{className:"w-3.5 h-3.5 text-emerald-400"}),(0,a.jsx)("span",{className:"text-emerald-400",children:"Copied"})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(p.A,{className:"w-3.5 h-3.5"}),(0,a.jsx)("span",{children:"Copy Text"})]})})]}),(0,a.jsx)("div",{className:"p-5 font-mono text-sm leading-relaxed overflow-x-auto",children:(0,a.jsx)("div",{className:"max-w-none text-right",dir:"rtl",children:s.document.content.split("\n").map((e,s)=>{if(e.startsWith("# "))return(0,a.jsx)("h1",{className:"text-xl font-bold mt-4 mb-2 text-white",children:e.replace("# ","")},s);if(e.startsWith("## "))return(0,a.jsx)("h2",{className:"text-lg font-bold mt-3 mb-2 text-white",children:e.replace("## ","")},s);let t=e.split(/(\*\*.*?\*\*)/g);return(0,a.jsx)("div",{className:"min-h-[1.2em]",children:t.map((e,s)=>e.startsWith("**")&&e.endsWith("**")?(0,a.jsx)("strong",{className:"text-white font-semibold",children:e.slice(2,-2)},s):(0,a.jsx)("span",{className:"text-gray-300",children:e},s))},s)})})}),(0,a.jsxs)("div",{className:"bg-gray-800/30 px-4 py-2 text-xs text-gray-500 border-t border-gray-700/50 flex justify-between",children:[(0,a.jsxs)("span",{children:["ID: ",s.document.id]}),s.message&&(0,a.jsx)("span",{children:s.message})]})]})};var v=t(6132),b=t(2529);let y=e=>{var s,t,r,l,n,i,o;let{data:d}=e,c=d.alreadyProcessed,x=(null==(s=d.file)?void 0:s.name)||(null==(t=d.existingFile)?void 0:t.file_name)||(null==(l=d.formatted_response)||null==(r=l.match(/Msg: (.*?)\n/))?void 0:r[1])||"File",u=(null==(n=d.google_drive)?void 0:n.link)||(null==(i=d.existingFile)?void 0:i.google_drive_web_view_link);return c?(0,a.jsx)("div",{className:"mt-4 bg-yellow-500/10 border border-yellow-500/20 rounded-xl p-4",children:(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsx)(v.A,{className:"w-5 h-5 text-yellow-500 mt-0.5"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-yellow-200",children:"File Already Exists"}),(0,a.jsx)("p",{className:"text-xs text-yellow-200/70 mt-1 mb-3",children:d.message||'The file "'.concat(x,'" has already been processed.')}),u&&(0,a.jsxs)("a",{href:u,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 text-xs font-medium bg-yellow-500/20 text-yellow-200 px-3 py-2 rounded-lg hover:bg-yellow-500/30 transition-colors",children:[(0,a.jsx)(m.A,{className:"w-3.5 h-3.5"}),"View Existing File"]})]})]})}):(0,a.jsx)("div",{className:"mt-4 bg-emerald-500/10 border border-emerald-500/20 rounded-xl p-4",children:(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsx)(b.A,{className:"w-5 h-5 text-emerald-500 mt-0.5"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-emerald-200 font-bold",children:"Upload Successful"}),(0,a.jsx)("p",{className:"text-xs text-emerald-200/70 mt-1 mb-3",children:d.message}),(0,a.jsxs)("div",{className:"bg-black/20 rounded-lg p-3 flex items-center gap-3",children:[(0,a.jsx)("div",{className:"p-2 bg-emerald-500/20 rounded-lg",children:(0,a.jsx)(h.A,{className:"w-4 h-4 text-emerald-400"})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("div",{className:"text-sm text-emerald-100 truncate",children:x}),(null==(o=d.file)?void 0:o.category)&&(0,a.jsx)("div",{className:"text-xs text-emerald-500/70",children:d.file.category})]}),u&&(0,a.jsx)("a",{href:u,target:"_blank",rel:"noopener noreferrer",className:"p-2 hover:bg-emerald-500/20 rounded-lg transition-colors text-emerald-400",title:"Open in Drive",children:(0,a.jsx)(m.A,{className:"w-4 h-4"})})]})]})]})})};var j=t(6504),N=t(4514);let w=e=>{let{message:s}=e,t="user"===s.role;return(0,a.jsx)("div",{className:"flex ".concat(t?"justify-end":"justify-start"," mb-6 animate-fadeIn"),children:(0,a.jsxs)("div",{className:"max-w-[85%] ".concat(t?"max-w-[70%]":"max-w-full"),children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,a.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-sm font-semibold ".concat(t?"bg-gradient-to-br from-purple-500 to-pink-500":"bg-gradient-to-br from-emerald-500 to-teal-500"),children:t?"U":"AI"}),(0,a.jsx)("span",{className:"text-sm font-medium text-gray-300",children:t?"You":"AI Assistant"}),(0,a.jsx)("span",{className:"text-xs text-gray-500",children:new Date(s.timestamp).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})})]}),(0,a.jsxs)("div",{className:"rounded-2xl px-5 py-4 ".concat(t?"bg-[var(--message-user)] ml-10":"bg-transparent ml-10"),children:[t&&s.files&&s.files.length>0&&(0,a.jsx)("div",{className:"mb-3 space-y-2",children:s.files.map(e=>(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-300",children:[(0,a.jsx)("span",{className:"text-lg",children:"\uD83D\uDCCE"}),(0,a.jsx)("span",{className:"truncate",children:e.name}),(0,a.jsxs)("span",{className:"text-xs text-gray-500",children:["(",(e.size/1024).toFixed(1)," KB)"]})]},e.id))}),(0,a.jsx)("div",{className:"text-[15px] leading-relaxed ".concat(t?"text-gray-100":"text-gray-50"," ").concat(t?"":"text-lg"),children:t?(0,a.jsx)("div",{className:"whitespace-pre-wrap",children:s.content}):(0,a.jsx)(j.oz,{remarkPlugins:[N.A],components:{table:e=>{let{node:s,...t}=e;return(0,a.jsx)("div",{className:"overflow-x-auto my-4 border rounded-lg border-gray-700 bg-gray-800/30",children:(0,a.jsx)("table",{className:"min-w-full divide-y divide-gray-700",...t})})},thead:e=>{let{node:s,...t}=e;return(0,a.jsx)("thead",{className:"bg-gray-800/80",...t})},tbody:e=>{let{node:s,...t}=e;return(0,a.jsx)("tbody",{className:"divide-y divide-gray-700 bg-gray-900/20",...t})},tr:e=>{let{node:s,...t}=e;return(0,a.jsx)("tr",{className:"hover:bg-gray-700/30 transition-colors",...t})},th:e=>{let{node:s,...t}=e;return(0,a.jsx)("th",{className:"px-4 py-3 text-right text-xs font-semibold text-gray-200 uppercase tracking-wider border-b border-gray-600",...t})},td:e=>{let{node:s,...t}=e;return(0,a.jsx)("td",{className:"px-4 py-3 whitespace-normal text-sm text-gray-300",...t})},p:e=>{let{node:s,...t}=e;return(0,a.jsx)("p",{className:"mb-3 last:mb-0 leading-7",...t})},a:e=>{let{node:s,...t}=e;return(0,a.jsx)("a",{className:"text-blue-400 hover:text-blue-300 hover:underline",target:"_blank",rel:"noopener noreferrer",...t})},ul:e=>{let{node:s,...t}=e;return(0,a.jsx)("ul",{className:"list-disc list-inside mb-3 space-y-1",...t})},ol:e=>{let{node:s,...t}=e;return(0,a.jsx)("ol",{className:"list-decimal list-inside mb-3 space-y-1",...t})},code:e=>{let{node:s,className:t,children:r,...l}=e,n=/language-(\w+)/.exec(t||"");return n||String(r).includes("\n")?(0,a.jsxs)("div",{className:"relative my-4 rounded-lg overflow-hidden bg-[#1e1e1e] border border-gray-700",children:[(0,a.jsx)("div",{className:"flex items-center justify-between px-4 py-2 bg-[#2d2d2d] border-b border-gray-700",children:(0,a.jsx)("span",{className:"text-xs text-gray-400 font-mono",children:(null==n?void 0:n[1])||"code"})}),(0,a.jsx)("div",{className:"overflow-x-auto p-4",children:(0,a.jsx)("code",{className:"font-mono text-sm ".concat(t),...l,children:r})})]}):(0,a.jsx)("code",{className:"bg-gray-800 px-1.5 py-0.5 rounded text-sm font-mono text-pink-300",...l,children:r})}},children:s.content})}),!t&&s.data&&(0,a.jsxs)("div",{className:"mt-2",children:["search"===s.data.type&&(0,a.jsx)(u,{data:s.data}),"document_generation"===s.data.type&&(0,a.jsx)(f,{data:s.data}),"upload"===s.data.type&&(0,a.jsx)(y,{data:s.data})]})]})]})})},_=e=>{let{messages:s,isLoading:t=!1}=e,l=(0,r.useRef)(null);return(0,r.useEffect)(()=>{var e;null==(e=l.current)||e.scrollIntoView({behavior:"smooth"})},[s,t]),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto scrollbar-thin px-4 py-6",children:(0,a.jsxs)("div",{className:"max-w-4xl mx-auto",children:[0===s.length?(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-center py-20",children:[(0,a.jsx)("div",{className:"w-20 h-20 rounded-full bg-gradient-to-br from-emerald-500 to-teal-500 flex items-center justify-center text-3xl font-bold mb-6",children:"AI"}),(0,a.jsx)("h1",{className:"text-3xl font-semibold text-gray-100 mb-3",children:"Welcome to AI Chat Assistant"}),(0,a.jsx)("p",{className:"text-gray-400 text-lg max-w-md",children:"Start a conversation by sending a message or uploading files"})]}):(0,a.jsxs)(a.Fragment,{children:[s.map(e=>(0,a.jsx)(w,{message:e},e.id)),t&&(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-6 animate-pulse",children:[(0,a.jsx)("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-emerald-500 to-teal-500 flex items-center justify-center text-sm font-semibold",children:"AI"}),(0,a.jsxs)("div",{className:"flex gap-1",children:[(0,a.jsx)("div",{className:"w-2 h-2 bg-gray-500 rounded-full animate-bounce",style:{animationDelay:"0ms"}}),(0,a.jsx)("div",{className:"w-2 h-2 bg-gray-500 rounded-full animate-bounce",style:{animationDelay:"150ms"}}),(0,a.jsx)("div",{className:"w-2 h-2 bg-gray-500 rounded-full animate-bounce",style:{animationDelay:"300ms"}})]})]})]}),(0,a.jsx)("div",{ref:l})]})})};var k=t(4285),A=t(8085),S=t(5229);let D=e=>{let{file:s,onRemove:t}=e;return(0,a.jsxs)("div",{className:"flex items-center gap-2 bg-[var(--message-user)] border border-[var(--border-color)] rounded-lg px-3 py-2 group hover:border-[var(--accent)] transition-colors",children:[(0,a.jsx)("span",{className:"text-2xl",children:(e=>e.includes("pdf")?"\uD83D\uDCC4":e.includes("excel")||e.includes("spreadsheet")?"\uD83D\uDCCA":e.includes("word")||e.includes("document")?"\uD83D\uDCDD":e.includes("image")?"\uD83D\uDDBCï¸":"\uD83D\uDCCE")(s.type)}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("p",{className:"text-sm font-medium truncate text-[var(--foreground)]",children:s.name}),(0,a.jsx)("p",{className:"text-xs text-gray-400",children:(e=>e<1024?e+" B":e<1048576?(e/1024).toFixed(1)+" KB":(e/1048576).toFixed(1)+" MB")(s.size)})]}),(0,a.jsx)("button",{onClick:()=>t(s.id),className:"p-1 hover:bg-red-500/20 rounded transition-colors opacity-0 group-hover:opacity-100","aria-label":"Remove file",children:(0,a.jsx)(S.A,{className:"w-4 h-4 text-red-400"})})]})},C=e=>{let{onSendMessage:s,disabled:t=!1}=e,[l,n]=(0,r.useState)(""),[i,o]=(0,r.useState)([]),d=(0,r.useRef)(null),c=(0,r.useRef)(null),m=()=>{(l.trim()||i.length>0)&&!t&&(s(l.trim(),i),n(""),o([]),d.current&&(d.current.style.height="auto"))},x=e=>{o(s=>s.filter(s=>s.id!==e))};return(0,a.jsx)("div",{className:"border-t border-[var(--border-color)] bg-[var(--chat-bg)] p-4",children:(0,a.jsxs)("div",{className:"max-w-4xl mx-auto",children:[i.length>0&&(0,a.jsx)("div",{className:"mb-3 flex flex-wrap gap-2",children:i.map(e=>(0,a.jsx)(D,{file:e,onRemove:x},e.id))}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("button",{onClick:()=>{var e;return null==(e=c.current)?void 0:e.click()},disabled:t,className:"p-3 rounded-xl bg-[var(--message-user)] hover:bg-[#3a3a3a] border border-[var(--border-color)] hover:border-[var(--accent)] transition-all disabled:opacity-50 disabled:cursor-not-allowed","aria-label":"Attach file",children:(0,a.jsx)(k.A,{className:"w-5 h-5 text-gray-300"})}),(0,a.jsx)("input",{ref:c,type:"file",multiple:!0,onChange:e=>{let s=Array.from(e.target.files||[]).map(e=>({file:e,id:Math.random().toString(36).substr(2,9),name:e.name,size:e.size,type:e.type}));o(e=>[...e,...s]),c.current&&(c.current.value="")},className:"hidden",accept:".pdf,.xlsx,.xls,.doc,.docx,.txt,.csv,image/*"}),(0,a.jsx)("div",{className:"flex-1 relative",children:(0,a.jsx)("textarea",{ref:d,value:l,onChange:e=>{n(e.target.value),d.current&&(d.current.style.height="auto",d.current.style.height=Math.min(d.current.scrollHeight,200)+"px")},onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),m())},disabled:t,placeholder:"Send a message...",rows:1,className:"w-full px-4 py-3 bg-[var(--message-user)] border border-[var(--border-color)] rounded-xl text-[var(--foreground)] placeholder-gray-500 resize-none focus:outline-none focus:border-[var(--accent)] transition-colors disabled:opacity-50 disabled:cursor-not-allowed scrollbar-thin",style:{maxHeight:"200px"}})}),(0,a.jsx)("button",{onClick:m,disabled:t||!l.trim()&&0===i.length,className:"p-3 rounded-xl transition-all ".concat(l.trim()||i.length>0?"bg-[var(--accent)] hover:bg-[var(--accent-hover)] text-white":"bg-[var(--message-user)] text-gray-500 cursor-not-allowed"," disabled:opacity-50"),"aria-label":"Send message",children:(0,a.jsx)(A.A,{className:"w-5 h-5"})})]}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-2 text-center",children:"Press Enter to send, Shift + Enter for new line"})]})})};function F(){let[e,s]=(0,r.useState)([]),[t,n]=(0,r.useState)(null),[i,o]=(0,r.useState)(!1),[c,m]=(0,r.useState)(!1),x=r.useRef(!0),u=r.useCallback(async e=>{try{let a=await fetch("https://n8n.srv974225.hstgr.cloud/webhook/get-conversations");if(a.ok){let r,l=await a.text();try{l&&(r=JSON.parse(l))}catch(e){console.warn("Invalid JSON from get-conversations",e);return}r&&r.success&&Array.isArray(r.conversations)&&(s(s=>{let a=new Map;s.forEach(e=>{a.set(e.id,e),e.session_id&&a.set(e.session_id,e)});let l=r.conversations.map(e=>{let s=e.id.toString(),t=a.get(s)||(e.session_id?a.get(e.session_id):null);return{id:s,session_id:e.session_id,title:e.title,messages:t?t.messages:[],createdAt:new Date(e.created_at),updatedAt:new Date(e.last_activity)}}),n=e||t;if(n&&!l.some(e=>e.id===n)){let e=s.find(e=>e.id===n);if(e)return[e,...l]}return l}),x.current&&(!t&&r.conversations.length>0&&n(r.conversations[0].id.toString()),x.current=!1))}}catch(e){console.error("Failed to fetch conversations",e),x.current=!1}},[t]);(0,r.useEffect)(()=>{u()},[u]),(0,r.useEffect)(()=>{if(t){let s=e.find(e=>e.id===t);s&&s.session_id&&0===s.messages.length&&h(s.session_id,t)}},[t,e]);let h=async(e,t)=>{m(!0);try{let a=await fetch("https://n8n.srv974225.hstgr.cloud/webhook/98b211e8-1325-4867-a937-9bdaa0f140d2/get-conversation/".concat(e));if(a.ok){let e,r=await a.text();if(!r)return;try{e=JSON.parse(r)}catch(e){console.warn("Invalid JSON from get-conversation",e);return}if(e.success&&Array.isArray(e.messages)){let a=e.messages.map((e,s)=>{var t,a,r;let l=null;return"semantic_search_results"===e.action||e.files&&e.files.length>0?l={type:"search",success:!0,found:!0,count:e.results_count||(null==(t=e.files)?void 0:t.length)||0,message:e.content,avg_similarity:e.avg_similarity||0,files:e.files||[],searchCriteria:e.search_criteria}:("document_generated"===e.action||e.document_content&&e.file_info)&&(l={type:"document_generation",action:"document_generation",success:!0,message:e.content,document:{title:(null==(a=e.file_info)?void 0:a.name)||"Generated Document",content:e.document_content,type:(null==(r=e.file_info)?void 0:r.type)||"document"}}),{id:"hist-".concat(s,"-").concat(Date.now()),role:"assistant"===e.role?"ai":"user",content:e.content,timestamp:new Date(e.timestamp),files:[],data:l}});s(e=>e.map(e=>e.id===t?{...e,messages:a}:e))}}}catch(e){console.error("Failed to load history",e)}finally{m(!1)}},g=async(e,a)=>{let r=t;if(!r){let t=Date.now().toString(),a={id:t,title:e.slice(0,30)||"New Chat",messages:[],createdAt:new Date,updatedAt:new Date};s(e=>[a,...e]),r=t,n(t)}p(r,e,a)},p=async(t,a,r)=>{var l,i,o,d;let c={id:Date.now().toString(),role:"user",content:a,timestamp:new Date,files:r};s(e=>e.map(e=>e.id===t?{...e,messages:[...e.messages,c],title:0===e.messages.length?a.slice(0,30)+(a.length>30?"...":""):e.title,updatedAt:new Date}:e)),m(!0);let x=null;try{let d=new FormData;r.forEach(e=>{d.append("files",e.file)}),d.append("query",a);let c=e.find(e=>e.id===t);c&&c.session_id&&d.append("session_id",c.session_id);let m=await fetch("https://n8n.srv974225.hstgr.cloud/webhook/auto-save-files",{method:"POST",body:d});if(!m.ok)throw Error("API Error: ".concat(m.statusText));let u=await m.text(),h={};try{u&&(h=JSON.parse(u))}catch(e){console.warn("Empty or invalid JSON response from N8N",e)}let g="Processed successfully.",p=null;if((x=Array.isArray(h)?h[0]:h)&&("vector"===x.searchType||x.files&&x.files.length>0?(p={type:"search",...x,files:x.files||[]},g=x.message||"Here are the files I found matching your request."):"document_generation"===x.action||x.document?(p={type:"document_generation",...x},g=x.message||"I have generated the document for you."):x.alreadyProcessed?(p={type:"upload",...x},g=x.message||"This file has already been processed."):x.success&&x.file?(p={type:"upload",...x},g=x.message||"File uploaded successfully."):x.message&&(g=x.message)),u||x||(g="Request received, but no response content was returned."),x&&(x.sessionId||(null==(l=x.conversation)?void 0:l.session_id))){let e=x.sessionId||(null==(i=x.conversation)?void 0:i.session_id),a=(null==(o=x.conversation)?void 0:o.id)?x.conversation.id.toString():null;s(s=>s.map(s=>s.id===t?{...s,session_id:e,id:a||s.id}:s)),a&&t!==a&&n(e=>e===t?a:e)}let f={id:(Date.now()+1).toString(),role:"ai",content:g,timestamp:new Date,data:p};s(e=>e.map(e=>{var s;let a=(null==x||null==(s=x.conversation)?void 0:s.id)&&t!==x.conversation.id.toString()?x.conversation.id.toString():t;return e.id===a||e.id===t?{...e,messages:[...e.messages,f],updatedAt:new Date}:e}))}catch(a){console.error("Error sending message:",a);let e={id:(Date.now()+1).toString(),role:"ai",content:"Sorry, I encountered an error communicating with the server. Please try again.",timestamp:new Date};s(s=>s.map(s=>s.id===t?{...s,messages:[...s.messages,e],updatedAt:new Date}:s))}finally{m(!1),u((null==x||null==(d=x.conversation)?void 0:d.id)&&t!==x.conversation.id.toString()?x.conversation.id.toString():t)}};return(0,a.jsxs)("div",{className:"flex h-screen bg-[var(--background)] text-[var(--foreground)] overflow-hidden",children:[(0,a.jsx)(d,{conversations:e,currentConversationId:t,onSelectConversation:n,onNewChat:()=>{n(null)},onDeleteConversation:(e,a)=>{a.stopPropagation(),s(s=>s.filter(s=>s.id!==e)),t===e&&n(null)},isOpen:i,onClose:()=>o(!1)}),(0,a.jsxs)("div",{className:"flex-1 flex flex-col h-full relative w-full",children:[(0,a.jsxs)("div",{className:"md:hidden flex items-center p-4 border-b border-[var(--border-color)] bg-[var(--background)]",children:[(0,a.jsx)("button",{onClick:()=>o(!0),className:"p-2 -ml-2 text-gray-400 hover:text-white",children:(0,a.jsx)(l.A,{className:"w-6 h-6"})}),(0,a.jsx)("span",{className:"ml-2 font-semibold",children:"AI Assistant"})]}),(0,a.jsx)(_,{messages:(()=>{let s=e.find(e=>e.id===t);return s?s.messages:[]})(),isLoading:c}),(0,a.jsx)(C,{onSendMessage:g,disabled:c})]})]})}}},e=>{e.O(0,[855,441,255,358],()=>e(e.s=6094)),_N_E=e.O()}]);